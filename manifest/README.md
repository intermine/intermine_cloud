## TODO

- Create `workflows` namespace to hold active argo workflows
- Expose Argo web server in *base/argo.yaml* so you don't have to use Argo CLI for dashboard.
- Handle keys and passwords using `secretGenerator` (ideally they should be autogenerated on deploy-time)
- Use `vars`
- Use `patchesStrategicMerge` instead of `patches`

## Development

```
kubectl apply -k overlays/dev
```

**MinIO dashboard**: `kubectl -n compose port-forward service/compose-minio 9000:9000` then open http://localhost:9000 (*Note*: You'll need the base64 decoded tokens)

## Generating base manifests

The first time you'll need to add the Helm repositories containing the charts.

```
helm repo add minio https://helm.min.io/
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo add nats https://nats-io.github.io/k8s/helm/charts/
helm repo update
```

Then you can generate the manifests.

```
curl https://raw.githubusercontent.com/argoproj/argo-workflows/master/manifests/install.yaml > base/argo/argo.yaml
helm template compose bitnami/postgresql > base/compose/postgresql.yaml
helm template compose minio/minio > base/compose/minio.yaml
helm template nats nats/nats > base/nats/nats.yaml
pushd ../helm-operator ; kustomize build config/default > ../manifest/base/intermine_operator.yaml ; popd
```
